"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[474],{2907:function(e,t,a){a(5331),a(6808),a(6711)},4752:function(e,t,a){a(5331),a(8736),a(8785)},5474:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});var i=a(9114),n=(a(5331),a(694),a(47)),o=(a(9648),a(7815)),l=(a(2907),a(5558)),s=(a(8075),a(7138)),r=(a(5802),a(7009)),d=(a(8450),a(4752),a(4880)),c=(a(7128),a(8507)),u=(a(213),a(4211)),p=a(6768),h=a(4232);const m={class:"container"},g={class:"header-content"},b={class:"header-action"},f={class:"main-container"},C={style:{margin:"8px"}},k={style:{"text-align":"center"}},y=["src"],w={key:2,style:{width:"100px",height:"100px",display:"flex","justify-content":"center","align-items":"center"}},v={class:"pagination-container"};function T(e,t,a,T,S,x){const F=u.A,L=(0,p.g2)("font-awesome-icon"),$=c.R7,D=d.bZ,_=s.o8,z=r.Zq,E=s.Up,A=l.qi,P=o.aQ,W=n.S2,M=i.A;return(0,p.uX)(),(0,p.CE)("div",m,[(0,p.bF)(D,null,{default:(0,p.k6)(()=>[(0,p.Lk)("div",g,[(0,p.bF)(F,{activeTab:"customerConfig"}),(0,p.Lk)("div",b,[(0,p.bF)($,{disabled:x.disableTooltip,content:e.$t("nav.logout"),placement:"bottom"},{default:(0,p.k6)(()=>[(0,p.bF)(L,{icon:"sign-out-alt",class:"header-icon",onClick:x.handleLogout},null,8,["onClick"])]),_:1},8,["disabled","content"])])])]),_:1}),(0,p.Lk)("div",f,[(0,p.bo)(((0,p.uX)(),(0,p.Wv)(E,{data:x.paginatedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,p.k6)(()=>[(0,p.bF)(_,{type:"expand"},{default:(0,p.k6)(t=>[(0,p.Lk)("div",C,[(0,p.Lk)("h3",k,(0,h.v_)(e.$t("customerConfig.uploadFileList")),1),(0,p.bF)(E,{data:t.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed","max-height":400},{default:(0,p.k6)(()=>[(0,p.bF)(_,{prop:"metadata.FileName",label:e.$t("customerConfig.fileName")},null,8,["label"]),(0,p.bF)(_,{label:e.$t("customerConfig.filePreview")},{default:(0,p.k6)(({row:e})=>[e.metadata?.FileType?.includes("image")?((0,p.uX)(),(0,p.Wv)(z,{key:0,src:"/file/"+e.id+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):e.metadata?.FileType?.includes("video")?((0,p.uX)(),(0,p.CE)("video",{key:1,src:"/file/"+e.id+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,y)):((0,p.uX)(),(0,p.CE)("div",w,[(0,p.bF)(L,{icon:"file",style:{"font-size":"2em"}})]))]),_:1},8,["label"]),(0,p.bF)(_,{formatter:x.formatTimeStamp,label:e.$t("customerConfig.uploadTime"),prop:"metadata.TimeStamp",sortable:"","sort-method":x.sortByTimestamp},{default:(0,p.k6)(({row:e})=>[(0,p.eW)((0,h.v_)(x.formatTimeStamp(e.metadata.TimeStamp)),1)]),_:1},8,["formatter","label","sort-method"])]),_:1},8,["data"])])]),_:1}),(0,p.bF)(_,{prop:"ip",label:e.$t("customerConfig.ipAddress")},null,8,["label"]),(0,p.bF)(_,{prop:"address",label:e.$t("customerConfig.address")},null,8,["label"]),(0,p.bF)(_,{prop:"count",label:e.$t("customerConfig.uploadCount"),sortable:""},null,8,["label"]),(0,p.bF)(_,{label:e.$t("customerConfig.allowUpload")},{default:(0,p.k6)(({row:t})=>[(0,p.bF)(A,{modelValue:t.enable,"onUpdate:modelValue":e=>t.enable=e,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":e.$t("customerConfig.allow"),"inactive-text":e.$t("customerConfig.forbid"),onChange:e=>x.handleSwitchEnable(t)},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text","onChange"])]),_:1},8,["label"])]),_:1},8,["data"])),[[M,S.loading]]),(0,p.Lk)("div",v,[(0,p.bF)(P,{background:"",layout:"prev, pager, next",total:S.dealedData.length,"current-page":S.currentPage,"page-size":S.pageSize,"pager-count":x.pagerCount,onCurrentChange:x.handlePageChange},null,8,["total","current-page","page-size","pager-count","onCurrentChange"]),S.currentPage===Math.ceil(S.dealedData.length/S.pageSize)?((0,p.uX)(),(0,p.Wv)(W,{key:0,type:"primary",onClick:x.loadMoreData,loading:S.loading,class:"load-more"},{default:(0,p.k6)(()=>[(0,p.eW)((0,h.v_)(e.$t("customerConfig.loadMore")),1)]),_:1},8,["onClick","loading"])):(0,p.Q3)("",!0)])])])}a(4114),a(8111),a(2489),a(1701);var S=a(797),x={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[],loading:!1,currentPage:1,pageSize:10}},components:{DashboardTabs:u.A},computed:{disableTooltip(){return window.innerWidth<768},pagerCount(){return window.innerWidth<768?3:7},paginatedData(){const e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.dealedData.slice(e,t)}},methods:{handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(e){return new Date(e).toLocaleString()},sortByTimestamp(e,t){return new Date(e.metadata.TimeStamp)-new Date(t.metadata.TimeStamp)},async handleSwitchEnable(e){const t=e.ip,a=e.enable;a?(this.blockipList=this.blockipList.filter(e=>e!==t),await(0,S.A)("/api/manage/cusConfig/whiteip",{method:"POST",body:t})):(this.blockipList.push(t),await(0,S.A)("/api/manage/cusConfig/blockip",{method:"POST",body:t}))},handlePageChange(e){this.currentPage=e,e===Math.ceil(this.dealedData.length/this.pageSize)&&this.loadMoreData()},loadMoreData(){this.loading=!0;const e=this.dealedData.length,t=20;(0,S.A)(`/api/manage/cusConfig/list?start=${e}&count=${t}`,{method:"GET"}).then(e=>e.json()).then(e=>{this.dealedData=this.dealedData.concat(e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}}))}).catch(()=>{this.$message.error(this.$t("customerConfig.loadError"))}).finally(()=>{this.loading=!1})},handleSizeChange(e){this.pageSize=e,this.currentPage=1}},mounted(){this.loading=!0,(0,S.A)("/api/manage/check",{method:"GET"}).then(e=>e.text()).then(e=>{if("true"==e)return this.showLogoutButton=!0,(0,S.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});if("Not using basic auth."==e)return(0,S.A)("/api/manage/cusConfig/list?count=20",{method:"GET"});throw new Error("Unauthorized")}).then(e=>e.json()).then(async e=>{const t=await(0,S.A)("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await t.text()).split(","),this.dealedData=e.map(e=>{const t=!this.blockipList.includes(e.ip);return{ip:e.ip,address:e.address,count:e.count,data:e.data,enable:t}})}).catch(e=>{"Unauthorized"!==e.message&&this.$message.error(this.$t("customerConfig.syncError"))}).finally(()=>{this.loading=!1})}},F=a(1241);const L=(0,F.A)(x,[["render",T],["__scopeId","data-v-3e69e63a"]]);var $=L},5802:function(e,t,a){a(5331),a(8736),a(213),a(5970)}}]);
//# sourceMappingURL=474.0d48280d.js.map